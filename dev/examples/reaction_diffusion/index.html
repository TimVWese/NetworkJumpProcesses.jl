<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Reaction Diffusion · NetworkJumpProcesses</title><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.045/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.24/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">NetworkJumpProcesses</a></span></div><form class="docs-search" action="../../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../sis/">SIS</a></li><li class="is-active"><a class="tocitem" href>Reaction Diffusion</a><ul class="internal"><li><a class="tocitem" href="#Defining-the-contact-network"><span>Defining the contact network</span></a></li><li><a class="tocitem" href="#Defining-the-vertex-reactions"><span>Defining the vertex reactions</span></a></li><li><a class="tocitem" href="#Defining-the-edge-reactions"><span>Defining the edge reactions</span></a></li><li><a class="tocitem" href="#Defining-the-network-jump-set"><span>Defining the network jump set</span></a></li><li><a class="tocitem" href="#Defining-the-problem"><span>Defining the problem</span></a></li><li><a class="tocitem" href="#Plotting-the-results"><span>Plotting the results</span></a></li><li><a class="tocitem" href="#Using-dependency-graphs"><span>Using dependency graphs</span></a></li></ul></li></ul></li><li><a class="tocitem" href="../../guide/">Guide</a></li><li><a class="tocitem" href="../../reference/">Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Examples</a></li><li class="is-active"><a href>Reaction Diffusion</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Reaction Diffusion</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/TimVWese/NetworkJumpProcesses.jl/blob/main/docs/src/examples/reaction_diffusion.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Reaction-Diffusion"><a class="docs-heading-anchor" href="#Reaction-Diffusion">Reaction Diffusion</a><a id="Reaction-Diffusion-1"></a><a class="docs-heading-anchor-permalink" href="#Reaction-Diffusion" title="Permalink"></a></h1><p>In this example, we simulate the diffusion and reaction of two chemical elements, A and B, which might react with each other and form C. C is disposed of in some sink nodes. Over the edges there happens diffusion.</p><h2 id="Defining-the-contact-network"><a class="docs-heading-anchor" href="#Defining-the-contact-network">Defining the contact network</a><a id="Defining-the-contact-network-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-contact-network" title="Permalink"></a></h2><p>The contact network is defined using the <code>erdos_renyi</code> function from the <code>Graphs</code> package. The function takes as input the number of nodes <code>n</code> and the probability of an edge between two nodes <code>p</code>.</p><pre><code class="language-julia hljs">using Graphs

n = 12
gg = erdos_renyi(n, 0.4)</code></pre><h2 id="Defining-the-vertex-reactions"><a class="docs-heading-anchor" href="#Defining-the-vertex-reactions">Defining the vertex reactions</a><a id="Defining-the-vertex-reactions-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-vertex-reactions" title="Permalink"></a></h2><p>The vertex reactions are defined using the <code>ConstantJumpVertex</code>(@ref) constructor. The function takes as input two anonymous functions: the first function defines the rate of the reaction, and the second function defines the update of the state. In this example, we define three vertex reactions: A<em>source, B</em>source, and C_sink. In the first two, respectively, A and B are produced at a constant rate, while in the third one C is disposed of.</p><pre><code class="language-julia hljs">using JumpProcesses

A_source = ConstantJumpVertex(
    (v, nghbs, p, t) -&gt; p.rA,
    (v, nghbs, p, t) -&gt; v[1] += 1
)

B_source = ConstantJumpVertex(
    (v, nghbs, p, t) -&gt; p.rB,
    (v, nghbs, p, t) -&gt; v[2] += 1
)

C_sink = ConstantJumpVertex(
    (v, nghbs, p, t) -&gt; p.dC*v[3],
    (v, nghbs, p, t) -&gt; v[3] -= 1
)</code></pre><h2 id="Defining-the-edge-reactions"><a class="docs-heading-anchor" href="#Defining-the-edge-reactions">Defining the edge reactions</a><a id="Defining-the-edge-reactions-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-edge-reactions" title="Permalink"></a></h2><p>The edge reactions are defined using the <code>ConstantJumpEdge</code>(@ref) function. Once again; two functions define the rate and affect the state. Note that the function signature sllightly differs from the vertex reactions. It is assumed that the diffusion is the same for all components, so it can be defined as follows.</p><pre><code class="language-julia hljs">diffusion = i -&gt; ConstantJumpEdge(
    (vs, vd, p, t) -&gt; max(p.D*(vs[i] - vd[i]), 0.),
    (vs, vd, p, t) -&gt; begin
        vs[i] -= 1
        vd[i] += 1
    end
)

diffusion_A = diffusion(1)
diffusion_B = diffusion(2)
diffusion_C = diffusion(3)</code></pre><h2 id="Defining-the-network-jump-set"><a class="docs-heading-anchor" href="#Defining-the-network-jump-set">Defining the network jump set</a><a id="Defining-the-network-jump-set-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-network-jump-set" title="Permalink"></a></h2><p>Since we make use heterogenous vertex jumps, we need to define an array of jumps for each node. Component C can be created in any node, and it can be disposed in three of them. A and B are also generated in 3 nodes.</p><pre><code class="language-julia hljs">A_source_reactions = [[A_source, C_creation] for i in 1:3]
B_source_reactions = [[B_source, C_creation] for i in 1:3]
C_sink_reactions = [[C_sink, C_creation] for i in 1:3]
v_reactions = vcat(A_source_reactions, B_source_reactions, C_sink_reactions)
append!(v_reactions, [[C_creation] for i in 1:(n-length(v_reactions))])
shuffle!(v_reactions)</code></pre><p>The edge jumps are homogeneous for all edges, so can be defined as a single array. Having the two sets of jumps, we can define the network jump set.</p><pre><code class="language-julia hljs">e_reactions = [diffusion_A, diffusion_B, diffusion_C]
jset = network_jump_set(gg; vertex_reactions=v_reactions,
                        edge_reactions=e_reactions, nb_states=3)</code></pre><h2 id="Defining-the-problem"><a class="docs-heading-anchor" href="#Defining-the-problem">Defining the problem</a><a id="Defining-the-problem-1"></a><a class="docs-heading-anchor-permalink" href="#Defining-the-problem" title="Permalink"></a></h2><p>A discrete problem is used with initial zero state and parameter tuple <code>p</code>. We first use the <code>Direct</code> aggregator.</p><pre><code class="language-julia hljs">p = (
    rA = 0.1,
    rB = 0.1,
    rC = 0.2,
    dC = 1.5,
    D = 0.1
)

T = 100.0
u₀ = zeros(Int64, 3*n)
dprob = DiscreteProblem(u₀, (0., T), p) 
direct_jump_prob = JumpProblem(dprob, Direct(), jset)
sol = solve(direct_jump_prob, SSAStepper())</code></pre><h2 id="Plotting-the-results"><a class="docs-heading-anchor" href="#Plotting-the-results">Plotting the results</a><a id="Plotting-the-results-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-the-results" title="Permalink"></a></h2><p>The amount of each component can be computed and plotted over time.</p><pre><code class="language-julia hljs">using Plots

get_concentrations(x::Vector{Int64}) = [
    sum(x[i] for i in 1:3:length(x)),
    sum(x[i] for i in 2:3:length(x)),
    sum(x[i] for i in 3:3:length(x))
]

get_concentrations(x::ODESolution) = reduce(hcat, [get_concentrations(x[t]) for t in eachindex(x)])&#39;;

plot(sol.t, get_concentrations(sol), label=[&quot;A&quot; &quot;B&quot; &quot;C&quot;], xlabel=&quot;t&quot;, ylabel=&quot;concentration&quot;, lw=2, legend=:topleft)</code></pre><h2 id="Using-dependency-graphs"><a class="docs-heading-anchor" href="#Using-dependency-graphs">Using dependency graphs</a><a id="Using-dependency-graphs-1"></a><a class="docs-heading-anchor-permalink" href="#Using-dependency-graphs" title="Permalink"></a></h2><p>It is also possible to use more performant aggregators that require dependency graphs, such as <a href="examples/[Title](https:/docs.sciml.ai/JumpProcesses/stable/jump_types/#Jump-Aggregators-Requiring-Dependency-Graphs)">RSSA</a>. this package provides two functions to generate the dependency graphs. Ihey require the underlying graph, the number of reactions per vertex, numer of reactions per edge and the number of states. The first two numbers can be either a single integer or an array of integers, depending on wheter the amounts are homogeneous over the vertices and edges or not. In this example, we use the same number of reactions for all edges, but not for the vertices. Hence we use the following code.</p><pre><code class="language-julia hljs">nb_vertex_reacs = [length(v) for v in v_reactions]
vtj = vartojumps(gg, nb_vertex_reacs, 3, 3)
jtv = jumptovars(gg, nb_vertex_reacs, 3, 3)

rssa_jump_prob = JumpProblem(dprob, RSSA(), jset; vartojumps_map=vtj, jumptovars_map=jtv)
sol = solve(rssa_jump_prob, SSAStepper())

plot(sol.t, get_concentrations(sol), label=[&quot;A&quot; &quot;B&quot; &quot;C&quot;], xlabel=&quot;t&quot;, ylabel=&quot;concentration&quot;, lw=2, legend=:topleft)</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../sis/">« SIS</a><a class="docs-footer-nextpage" href="../../guide/">Guide »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.25 on <span class="colophon-date" title="Friday 22 September 2023 12:19">Friday 22 September 2023</span>. Using Julia version 1.6.7.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
